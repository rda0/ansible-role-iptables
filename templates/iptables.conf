##### iptables rules configuration file #####


## General options

# Debugging (verbosity: 0=off, 1=debug, 2=debugrules)
DEBUG=2

# Script options
PATH=/sbin:/usr/sbin:/bin:/usr/bin

# Logging options (`--log-prefix` always required as last option)
LOG_OPTS="--log-level 7 --log-ip-options --log-uid --log-prefix"

# Interfaces
IF_EXT="{{ iptables_if_ext | default(ansible_default_ipv4.interface) }}"
IF_BR_EXT="{{ iptables_if_br_ext | default() }}"
IF_BR="{{ iptables_if_br | default() }}"
IF_INT=""

# Allow ICMP echo-request from anywhere (true|false)
ALLOW_PING_INET="{{ iptables_allow_ping_inet | default('true') }}"


### IP addresses (single IP addresses)

## IP addresses with administrative access
# Static variables
NET4_ADM_0="192.33.99.1"     # rda.ethz.ch        (rda)
NET4_ADM_1="192.33.96.20"    # mothership.ethz.ch (daduke)
NET4_ADM_2="192.33.99.55"    # kedavra.ethz.ch    (sasquatch)
NET4_ADM_3="192.33.96.71"    # dumbledore.ethz.ch (chris-tux)
NET4_ADM_4="192.33.99.100"   # inferius.ethz.ch   (ataraxia)
NET4_ADM_5="192.33.98.60"    # reparo.ethz.ch     (shamu)
NET4_ADM_6="192.33.97.122"   # portus.ethz.ch     (globi)
NET4_ADM_7="192.33.96.147"   # methyer.ethz.ch    (tarzeau)
NET4_ADM_8="192.33.98.148"   # ash.ethz.ch        (amartako)
NET4_ADM_9="" #"192.33.99.99"    # snidget.ethz.ch    (rda)
NET4_ADM_10="129.132.89.142" # griphook.ethz.ch   (jumphost)
NET4_ADM_11="129.132.89.144" # hirzli.ethz.ch     (jumphost)
NET4_ADM_12="" #"129.132.86.215" # phd-webxen.ethz.ch
NET4_ADM_13="" #"129.132.86.214" # phd-systemxen.ethz.ch
NET4_ADM_14="" #"129.132.53.172" # silberspitz.ethz.ch
NET4_ADM_15="" #"129.132.80.42"  # silberspitz-hpx137.ethz.ch
# Ansible variables
NET4_ADM_CUSTOM="{{ iptables_net4_adm_custom | default() }}"
NET6_ADM_CUSTOM="{{ iptables_net6_adm_custom | default() }}"
# Script variables
NET4_ADMIN="${NET4_ADM_CUSTOM} ${NET4_ADM_0} ${NET4_ADM_1} ${NET4_ADM_2} ${NET4_ADM_3} ${NET4_ADM_4} ${NET4_ADM_5} ${NET4_ADM_6} ${NET4_ADM_7} ${NET4_ADM_8} ${NET4_ADM_9} ${NET4_ADM_10} ${NET4_ADM_11} ${NET4_ADM_12} ${NET4_ADM_13} ${NET4_ADM_14} ${NET4_ADM_15}"
NET6_ADMIN="${NET6_ADM_CUSTOM}"

### Networks (in CIDR notation)

## Local server networks
# Static variables
NET4_SRV_PHYS_SERVER="129.132.86.192/27"               # server1
NET4_SRV_PHYS_DC_SERVER_1="129.132.80.0/26"            # server2
NET4_SRV_PHYS_DC_SERVER_2="" #"172.31.108.0/24"        # server2 internal
NET4_SRV_PHYS_DC_SPEC_4="" #"172.31.34.32/27"          # backup iscsi
NET4_SRV_PHYS_DC_DOCK_1="129.132.89.128/25"            # client/server in server room only
NET4_SRV_LAB="192.33.97.20/32 192.33.97.21/32 192.33.97.22/32 192.33.97.23/32 192.33.99.66/32 192.33.99.72/32 192.33.96.149/32"
NET6_SRV_PHYS_DC_SERVER_1="2001:67c:10ec:3dc4::/118"   # server ipv6
NET6_SRV_PHYS_DC_DOCK_1="2001:67c:10ec:3dc2::/118"     # docking ipv6 server room only
# Ansible variables
NET4_SRV_CUSTOM="{{ iptables_net4_srv_custom | default() }}"
NET6_SRV_CUSTOM="{{ iptables_net6_srv_custom | default() }}"
# Script variables
NET4_SERVER="${NET4_SRV_CUSTOM} ${NET4_SRV_PHYS_SERVER} ${NET4_SRV_PHYS_DC_SERVER_1} ${NET4_SRV_PHYS_DC_SERVER_2} ${NET4_SRV_PHYS_DC_SPEC_4} ${NET4_SRV_PHYS_DC_DOCK_1} ${NET4_SRV_LAB}"
NET6_SERVER="${NET6_SRV_CUSTOM} ${NET6_SRV_PHYS_DC_SERVER_1} ${NET6_SRV_PHYS_DC_DOCK_1}"

## Local trusted networks (allowed: icmp, policy: REJECT)
# Static variables
NET4_TRU_ETH="82.130.64.0/18 129.132.0.0/16 195.176.96.0/19 148.187.192.0/19 192.33.87.0/24 192.33.88.0/23 192.33.91.0/24 192.33.92.0/24 192.33.93.0/24 192.33.94.0/23 192.33.96.0/21 192.33.104.0/22 192.33.108.0/23 192.33.110.0/24"
NET6_TRU_ETH="2001:67c:10ec::/48"
# Ansible variables
NET4_TRU_CUSTOM="{{ iptables_net4_tru_custom | default() }}"
NET6_TRU_CUSTOM="{{ iptables_net6_tru_custom | default() }}"
# Script variables
NET4_TRUSTED="${NET4_TRU_CUSTOM} ${NET4_TRU_ETH}"
NET6_TRUSTED="${NET6_TRU_CUSTOM} ${NET6_TRU_ETH}"

## Private networks (not routed in internet)
# Private IPv4 address spaces (RFC 1918)
NET4_PRIVATE="10.0.0.0/8 172.16.0.0/12 192.168.0.0/16"
# Unique local IPv6 address spaces (RFC 4193)
NET6_PRIVATE="fc00::/7"
# Static variables
NET4_PRV_ETH="172.30.0.0/16 172.31.0.0/16 10.2.0.0/19 10.2.32.0/19 10.2.64.0/20 10.2.80.0/20 10.2.96.0/20 10.2.112.0/20 10.2.128.0/20 10.2.144.0/20 10.2.160.0/20 10.2.176.0/20 10.2.192.0/20 10.5.0.0/16 10.6.0.0/16 10.4.0.0/16"
NET6_PRV_ETH=""
# Ansible variables
NET4_PRV_CUSTOM="{{ iptables_net4_prv_custom | default() }}"
NET6_PRV_CUSTOM="{{ iptables_net6_prv_custom | default() }}"
# Script variables
NET4_PRIVATE_EXCEPT="${NET4_PRV_CUSTOM} ${NET4_PRV_ETH}"
NET6_PRIVATE_EXCEPT="${NET6_PRV_CUSTOM} ${NET6_PRV_ETH}"

## Custom networks (for host specific rules)
# Script variables
NET4_CUSTOM="{{ iptables_net4_custom | default() }}"
NET6_CUSTOM="{{ iptables_net6_custom | default() }}"

#### Open Ports

### Admin
## Inbound
# ssh
I_TCP_ADM="{{ iptables_i_tcp_adm | default('22') }}"
# mosh
I_UDP_ADM="{{ iptables_i_udp_adm | default('60000:61000') }}"
## Outbound
# ssh
O_TCP_ADM="{{ iptables_o_tcp_adm | default('22') }}"
# 
O_UDP_ADM="{{ iptables_o_udp_adm | default() }}"
## Forward
# format: "interface:target_ip:target_port"
F_TCP_ADM="{{ iptables_f_tcp_adm | default() }}"
# 
F_UDP_ADM="{{ iptables_f_udp_adm | default() }}"

### Network (server)
## Inbound
# 
I_TCP_SRV="{{ iptables_i_tcp_srv | default('22') }}"
# ntp
I_UDP_SRV="{{ iptables_i_udp_srv | default('123') }}"
## Outbound
# 
O_TCP_SRV="{{ iptables_o_tcp_srv | default() }}"
# ntp
O_UDP_SRV="{{ iptables_o_udp_srv | default('123') }}"
## Forward
# format: "interface:target_ip:target_port"
F_TCP_SRV="{{ iptables_f_tcp_srv | default() }}"
# 
F_UDP_SRV="{{ iptables_f_udp_srv | default() }}"

### Network (trusted), includes: Trusted, Server, Admin
## Inbound
# 
I_TCP_TRU="{{ iptables_i_tcp_tru | default() }}"
# 
I_UDP_TRU="{{ iptables_i_udp_tru | default() }}"
## Outbound
# dhcp
O_TCP_TRU="{{ iptables_o_tcp_tru | default('67') }}"
# dhcp
O_UDP_TRU="{{ iptables_o_udp_tru | default('67') }}"
## Forward
# format: "interface:target_ip:target_port"
F_TCP_TRU="{{ iptables_f_tcp_tru | default() }}"
# 
F_UDP_TRU="{{ iptables_f_udp_tru | default() }}"

### Network (custom), host specific
## Inbound
# ssh
I_TCP="{{ iptables_i_tcp | default() }}"
# 
I_UDP="{{ iptables_i_udp | default() }}"
## Outbound
# ssh
O_TCP="{{ iptables_o_tcp | default() }}"
# 
O_UDP="{{ iptables_o_udp | default() }}"
## Forward
# format: "interface:target_ip:target_port"
F_TCP="{{ iptables_f_tcp | default() }}"
# 
F_UDP="{{ iptables_f_udp | default() }}"

### Internet (default)
## Inbound
# ssh
I_TCP_INET="{{ iptables_i_tcp_inet | default() }}"
# 
I_UDP_INET="{{ iptables_i_udp_inet | default() }}"
## Outbound
# ssh smtp whois dns rwhois http https git gpg
O_TCP_INET="{{ iptables_o_tcp_inet | default('22 25 43 53 4321 80 443 9418 11371') }}"
# whois dns ntp
O_UDP_INET="{{ iptables_o_udp_inet | default('43 53 123') }}"
## Forward
# format: "interface:target_ip:target_port"
F_TCP_INET="{{ iptables_f_tcp_inet | default() }}"
# 
F_UDP_INET="{{ iptables_f_udp_inet | default() }}"

#### Port forwards
# format: "interface:port:target_ip:target_port"
F_TCP_NAT4="{{ iptables_f_tcp_nat4 | default() }}"
# 
F_UDP_NAT4="{{ iptables_f_udp_nat4 | default() }}"
